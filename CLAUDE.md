# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a Python-based data pipeline for scraping, synchronizing, and analyzing movie data from Douban and IMDb. The project is structured as a command-line application with a clear separation of concerns:

-   **Scrapers**: Scripts dedicated to fetching data from Douban and IMDb and saving it to CSV files.
-   **Orchestrator**: A main entry point (`main.py`) to run the entire pipeline using command-line arguments.
-   **Utilities**: Helper scripts for merging and synchronizing data.

## Commands

The main entry point for the application is `main.py`.

-   **Install dependencies:**
    ```bash
    pip install -r requirements.txt
    ```

-   **Run scrapers:**
    -   **Scrape a specific platform:**
        ```bash
        python main.py scrape [douban|imdb|all]
        ```
    -   **Perform a full scrape (ignoring previous data):**
        ```bash
        python main.py scrape [douban|all] --full-scrape
        ```

-   **Synchronize ratings between platforms:**
    ```bash
    python main.py sync <source> <target>
    ```
    -   `<source>`: The platform to copy ratings from (`douban` or `imdb`).
    -   `<target>`: The platform to copy ratings to (`douban` or `imdb`).
    -   `--dry-run` or `-dr`: Perform a dry run to see what would be synced without making changes.
    -   `--limit` or `-l`: Syncs only the specified number of oldest movies.

-   **Compare ratings between platforms:**
    ```bash
    python main.py compare <source> <target>
    ```
    -   `<source>`: The platform that has the ratings.
    -   `<target>`: The platform to check for missing ratings.

## Important Notes

-   The script `main.py` has a hardcoded Python executable path: `/Users/gawaintan/miniforge3/envs/film/bin/python`. This may need to be adjusted depending on the environment.
-   The Douban username is retrieved from `config/config.py`.
-   The IMDb username is currently hardcoded in `main.py`.

## Project Structure

-   `main.py`: The main entry point for the CLI application.
-   `scrapers/`: Contains the web scraping scripts (`douban_scraper.py`, `imdb_scraper.py`).
-   `utils/`: Contains utility scripts for data processing and synchronization.
-   `config/`: Contains configuration files.
-   `data/`: Stores the CSV files generated by the scrapers.
-   `requirements.txt`: Lists the Python dependencies for the project.

## Key Libraries

-   **argparse**: Used to create the command-line interface in `main.py`.
-   **subprocess**: Used by `main.py` to orchestrate the different pipeline scripts.
-   **pandas**: Used for data manipulation.
-   **requests**: Used for synchronous HTTP requests.
-   **tqdm**: Used for displaying progress bars.
